# Salesbot CDN widget

Легкий PHP-стек для демонстрации:

1. `salesbot.php` — единственный скрипт, который будет раздаваться через `https://cdn.weba-ai.com/salesbot.php`.
   Он вставляет виджет в `document.body`, читает `data-*` атрибуты и отправляет сообщения на `api/chat.php`.
2. Каждый клиент указывает свой `botId` через `data-salesbot-id`. Это ключ для конфига в `data/clients.php`.
3. `api/chat.php` показывает, какие данные будут приходить, и возвращает демо-ответ. В будущем здесь добавляется HTTP-запрос к `n8nWebhookUrl`.
4. `demo/index.html` показывает, как подключить виджет и указать кастомные значения в атрибутах.

## Запуск локально

1. Убедитесь, что у вас есть PHP (например, `php -S localhost:8000`).
2. Запустите сервер из корня репозитория:  
   `php -S 0.0.0.0:8000`
3. Откройте `http://localhost:8000/demo/index.html` и кликните по круглой иконке — появится чат.

## Как подключить к клиенту

Клиент вставляет:

```html
<script src="https://cdn.weba-ai.com/salesbot.php"
        data-salesbot-id="client-alpha"
        data-salesbot-user-id="user-123">
</script>
```

`botId` переводится в конфигурацию из `data/clients.php`. Каждое `botId` может ссылаться на свой `n8nWebhookUrl`.

## Интеграция с n8n

`api/chat.php` сейчас отвечает тестовым текстом, но уже возвращает поле `n8nWebhookUrl`. В production:

1. Прокиньте `message + metadata` на `n8nWebhookUrl` (обычно это POST с JSON).
2. Полученный ответ отдавайте обратно пользователю в формате `messages`.
3. Можно кешировать, добавлять очереди, логировать события (см. TODO внутри файла).

## Автодеплой и CDN

Для CDN достаточно, чтобы `cdn.weba-ai.com` отдавал `salesbot.php` и `api/chat.php` (возможно, через PHP runtime или edge-руту).
`api/chat.php` должен быть доступен на том же домене (или иметь CORS), чтобы виджет мог посылать запросы. На этапе демо можно использовать одинаковые урлы для скрипта и API.

## Что сделано в первой итерации

- сайт-демо с кнопкой и чат-окном (`demo/index.html`);
- CDN-скрипт, который работает без внешних библиотек и рендерит чат;
- API-прокси, который читает `botId`, возвращает демо-ответ и сообщает, к какому `n8nWebhookUrl` нужно подключиться;
- настройка для нескольких клиентов в `data/clients.php`.

